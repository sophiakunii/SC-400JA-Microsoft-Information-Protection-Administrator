# 演習 3 - 機密情報の種類を管理する

Contoso Ltd. は以前、チケット ソリューションでサポート チケットに取り組んでいる際に、従業員が誤って顧客の個人情報を送信するという問題がありました。将来的にユーザーを教育するために、電子メールやドキュメントで**従業員 ID を識別**するためのカスタム機密情報の種類が必要です。これは **3 つの大文字と 6 つの数字**で構成されます。誤検知率を下げるために、キーワード「Employee」と「ID」が使用されます。このタスクでは、新しいカスタム機密情報の種類、EDM ベースの分類用のデータベース、およびキーワード辞書を作成します。

### タスク 1 - カスタム機密情報の種類を作成する

この演習では、セキュリティ/コンプライアンス センター PowerShell モジュールを用い、キーワード 「Employee」と「ID」に近い従業員 ID のパターンを認識するカスタム機密情報を新しく作成します。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしておきます。

2. **Microsoft Edge** で、**https://compliance.microsoft.com** に移動し、JoniS@WWLxZZZZZZ.onmicrosoft.com としてコンプライアンス センターにログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  Joni のパスワードは管理者と同じです。

3. 左側のナビゲーション ウィンドウから 「**データ分類**」 を選択します。

4. 「**データ分類とは？**」 のメッセージが表示されたら、「**閉じる**」 を選択します。

5. 上部のメニュータブから 「**機密情報の種類**」 を選択します。    <BR>ヒント: 「**機密情報の種類**」がコンプライアンス センターに表示されない場合は、以前の手順で実施したコンプライアンス管理者に対する Joni のアクセス許可がまだ更新されていない可能性があります。  サインアウトし、Joni でもう一度サインインする必要があります。

5. 「**+ 機密情報の種類を作成**」 を選択し、新しい機密情報の種類を作成するウィザードを開きます。

6. 「**名前と説明の入力**」ページで 「**名前**」に、「**Contoso 従業員 ID**」 入力します。

7. 「**説明**」フィールドに「**Contoso 従業員 ID のパターン**」と入力して「**次へ**」を選択します。

8. 「**この機密情報の種類のパターンを定義する**」ページで、「**+ パターンを作成する**」を選択します。

9. 「**主要要素**」セクションで「**+ 主要要素を追加**」のドロップダウン フィールドを選択し、「**正規表現**」を選択します。

10. 「**ID**」フィールドに「*Contoso ID*」と入力し、「正規表現」フィールドに次のように入力します。*\s[A-Z]{3}[0-9]{6}\s*、その後、「**完了**」を選択します。

11. 新しいパターン ウィンドウで、**文字の近接度**値を *100* 文字に減らします。

12. 「**補助要素**」の下で、「**+ 補助要素または要素のグループを追加**」ドロップダウン メニューを選択し、「**キーワードのリスト**」を選択します。

13. 「ID」フィールドに **従業員 ID キーワード** と入力し、**大文字と小文字を区別しない** 下のテキスト ボックスに次のように入力して、「**完了**」を選択します。

- *emoloyee*
- *id* 

14. 「**作成**」ボタンを選択します。

15. 「**この機密情報の種類のパターンを定義する**」ページで、「**次へ**」を選択します。

16. 「**コンプライアンス ポリシーに表示する推奨の信頼度レベルを選択する**」ページで、既定値を使用して「**次へ**」を選択します。

17. 「**設定の確認して完了する**」ページで、設定を確認し、「**作成**」を選択します。正常に作成されたら、「**完了**」を選択します。

18. ブラウザー ウィンドウは開いたままにしておきます。

100 文字の範囲内で、3 つの大文字、6 つの数字、キーワード「emoloyee」、「ID」のパターンで、従業員 ID を特定する、新しい機密情報の種類を作成しました。

### タスク 2 – EDM(Exact Data Match) ベースの分類情報の種類を作成する。

追加の検索パターンとして、従業員データのデータベース スキーマで EDMベースの分類を作成します。データベース ソース ファイルは以下の従業員のデータ フィールドでフォーマットされます: Name、Birthdate、StreetAddress、EmployeeID。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. 必要なAzure AD セキュリティ グループを作成するには、右上角のユーザー画像を選択して Joni Sherman のアカウントからサインアウトします。

3. ブラウザー画面を閉じ、新しいブラウザー画面を開きます。

4. **Microsoft Edge** で、**https://admin.microsoft.com** に移動します。

5. 「**アカウントを選択**」ページが表示されたら、「**別のアカウントを使用**」を選択し、**MOD 管理者** admin@WWLxZZZZZZ.onmicrosoft.com (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID) としてサインインします。  管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

6. 左側のナビゲーション ウィンドウから「**チームとグループ**」を選択し、「**アクティブなチームとグループ**」を選択します。

7. 上部のウィンドウから「**グループの追加**」を選択します。

8. 「**グループの種類の選択**」ページで、「**セキュリティ**」、「**次へ**」を選択します。

9. 「**基本設定**」の「**名前**」フィールドに「**EDM_DataUploaders**」と入力します。  「説明」フィールドに「**EDM にデータをアップロードする管理者**」と入力します。

10. 「**次へ**」をクリックします。

11. 「**確認とグループの追加の完了**」ページで、設定を確認し、「**グループの作成**」を選択します。

12. 「**新しいグループが作成されました**」ページが表示されたら、「**閉じる**」を選択します。

13. 「**セキュリティ**」タブで「**更新**」をクリックして画面をリフレッシュし、新しく作成された「**EDM_DataUploaders**」グループをリストから選択してます。

14. 「**メンバー**」タブを選択し、「**すべてのメンバーの表示と管理**」を選択します。

15. 「**グループ メンバーの管理**」画面で、「**(+) メンバーの追加**」を選択します。

16. 「**Joni Sherman**」を選択し、「**追加 (1)**」ボタンを選択してから、戻る矢印ボタンを選択します。

17. 「**Joni Sherman**」が「**メンバー**」の下に表示されていることを確認します。

18. 右側のウィンドウを「**X**」で閉じます。

19. MOD 管理者のイニシャル「**MA**」の丸を選択し、「**サインアウト**」を選択します。

20. ブラウザー画面を閉じ、新しいブラウザー画面を開きます。

21. Microsoft 365 コンプライアンス センター (https://compliance.microsoft.com) に移動します。

22. 「**アカウントを選択する**」ページが表示されたら、「**Joni Sherman**」を選択してサインインします。

23. 「**データの分類**」に移動し、「**完全なデータ一致**」タブを選択します。

24. 「**+ EDM スキーマを作成する**」を選択し、新しいスキーマの定義を作成します。

25. 「**名前**」フィールドに、「*employeedb*」と入力します。

26. 「**説明**」フィールドに、「*従業員データベース スキーマ*」と入力します。

27. 「**すべてのスキーマ フィールドの区切り文字と句読点を無視する**」を選択します。

28. 「**無視する区切り記号と句読点を選択する**」を選択し、*ハイフン*、*ピリオド*、*スペース*、*左かっこ「(」*、*右かっこ「)」*を選択します。

29. 最初の「**スキーマ フィールド名**」で「*Name*」と入力し、「**フィールドは検索可能です**」ボックスのマークを付けます。

30. 「**+ スキーマ データ フィールドを追加**」を選択します。

31. 「**スキーマ フィールド 2**」で「**スキーマ フィールド名**」に「*Birthdate*」と入力します。

32. 「**+ スキーマ データ フィールドを追加**」を選択します。

33. 「**スキーマ フィールド 3**」で「**スキーマ フィールド名**」に「*StreetAddress*」と入力します。

34. 「**+ スキーマ データ フィールドを追加**」を選択します。

35. 「**スキーマ フィールド No. 4**」で「**スキーマ フィールド名**」に「*EmployeeID*」と入力します。

36. 「**フィールドは検索可能**」を選択します。 

37. 「**保存**」を選択します。

38. 左のメニューウィンドウから「**EDM の機密情報の種類**」を選択します。

39. 「**+ EDM の機密情報の種類を作成**」を選択すると、「**EDM ルール パッケージ**」ウィザードが開きます。

40. 「**データ ストア スキーマの定義**」ページで、「**既存の EDM スキーマを選択する**」を選択します。

41. 「**employeedb**」を選択し、「**追加**」を選択します。

42. データ ストア スキーマを確認してから、「**次へ**」を選択します。

43. 「**この EDM 機密情報の種類のパターンを定義する**」ページで、「**+ パターンを作成する**」を選択します。

44. 「**新しいパターン**」ウィンドウの、**一次要素** フィールドで「*EmployeeID*」を選択します。

45. 「**一次要素の機密情報の種類**」で、「**機密情報の種類を選択**」を選択します。 

46. 「**検索**」バーで、「*Contoso*」と入力し、Enter キーを押します。

47. 「**Contoso 従業員 ID**」を選択し、「**完了**」を選択します。

48. 「**完了**」を選択します。

49. 「**次へ**」をクリックします。

50. 「**信頼度の推奨レベルと文字の近接度を選択する**」で、既定値を維持し、「**次へ**」を選択します。

51. 「**EDM 機密情報の種類の名前と説明の設定**」ページで、「*Contoso Employee EDM*」と入力します。

52. 「**管理者向けの説明**」フィールドで、「*従業員の個人情報向けの、EDM ベースの機密情報の種類*」と入力します。

53. 「**次へ**」を選択して、設定を確認し、「**送信**」を選択します。

54. 「**EDM 機密情報の種類が作成されました**」ページで、「**完了**」を選択します。

55. Microsoft 365 コンプライアンス センター のブラウザー画面は開いたままにします。

データベース ファイル ソースから従業員データを特定するための、EDM ベースの分類による機密情報の種類を作成しました。

### タスク 3 – EDM ベースの分類情報の種類を作成する。

EDM ベースの分類を機密データを含むデータベースと関連付けるには、機密データの種類の実際のデータを EDM アップロード エージェント ツールを通してハッシュ化し、アップロードする必要があります。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. **Microsoft Edge** で、**https://go.microsoft.com/fwlink/?linkid=2088639** に移動し、**EDM アップロード エージェント(EdmUploadAgent.msi)** をダウンロードします。

3. ダウンロードしたファイル実行し、ツールをインストールします。

5. 「**Welcome to the Microsoft Exact Data Match Upload Agent Setup Wizard**」で「**Next**」を選択します。

6. 「**End-User License Agreement**」で同意をチェックして、「**Next**」を選択します。

7. 既定の「**Destination Folder**」パスは変更せずに、「**Next**」を選択します。

8. 「**Install**」を選択してインストールを実行します。

9. 「**ユーザー アカウント制御**」ウィンドウが開いたら、「**はい**」を選択します。

10. インストールが完了したら、「**Finish**」 を選択します。

11. 左下の Windows ボタンを選択して、スタート メニューを開き、「**Notepad**」と入力して、スタートメニューから「**メモ帳**」を選択します。

12. メモ帳のウィンドウの最初の行に次のテキストを入力します。

    ```
    Name,Birthdate,StreetAddress,EmployeeID
    Joni Sherman,01.06.1980,1 Main Street,CSO123456
    Lynne Robbins,31.01.1985,2 Secondary Street,CSO654321
    ```
    
15. 「**名前を付けて保存**」を選択し、「**エンコード:**」が「**UTF-8**」であることを確認したら、**EmployeeData.csv** というファイル名で「**ドキュメント**」フォルダに保存してください。このとき、ファイルの種類は「**すべてのファイル**」を選択するようにしてください。

19. メモ帳ウィンドウを閉じます。

20. Windows ボタンを右クリックし、**Windows PowerShell** を管理者として実行します。

21. 「**ユーザー アカウント制御**」ウィンドウが開いたら、「**はい**」を選択します。

22. EDM アップロード エージェント ディレクトリまで移動します:

    ```
    cd "C:\Program Files\Microsoft\EdmUploadAgent"
    ```

23. 次のコマンドレットを実行して、自分のアカウントでデータベースをテナントにアップロードすることを承認します:

    ```
    .\EdmUploadAgent.exe /Authorize
    ```

24. 「**アカウントを選択**」ウィンドウが表示されたら、JoniS@WWLxZZZZZZ.onmicrosoft.com (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID) としてサインインします。  Joni のパスワードは管理者と同じです。

25. 以下のスクリプトを PowerShell で実行して、EDB ベースの分類による秘密情報の種類のデータベース スキーマの定義をダウンロードします:

    ```
    .\EdmUploadAgent.exe /SaveSchema /DataStoreName employeedb /OutputDir "C:\Users\Admin\Documents\"
    ```

    注: このコマンドが失敗したら、**EDM_DataUploaders** グループ メンバーシップが適用されるまでもう少し時間がかかる可能性があります。スキーマ ファイルをダウンロードすることができるようになるまで最大 1 時間かかる場合があります。  失敗した場合は、一旦次の**タスク 4** に進み、後でこの手順に戻ります。<br><br>
    
    注: Schema not found for datastore employeedb というエラーが発生する場合は、作成したスキーマがシステムに認識されていないことを意味しています。この場合は、このステップをスキップして**タスク 4**に進んでください。スキーマが認識されるまで、最大 24 時間かかる場合があります。

26. PowerShell で以下のスクリプトを実行して、データベース ファイルをハッシュ化し、EDB ベースの分類による秘密情報の種類にアップロードします。
    
    ```
    .\EdmUploadAgent.exe /UploadData /DataStoreName employeedb /DataFile "C:\Users\Admin\Documents\EmployeeData.csv" /HashLocation "C:\Users\Admin\Documents\" /Schema "C:\Users\Admin\Documents\employeedb.xml"
    ```

27. 状態が完了に変化するまでアップロードの進捗を確認し、次の PowerShell コマンドを実行します:

    `.\EdmUploadAgent.exe /GetSession /DataStoreName employeedb`

28. PowerShell ウィンドウを閉じます。

EDB ベースの分類による秘密情報の種類のためにデータベース ファイルがハッシュ化し、アップロードされました。

### タスク 4 – キーワード辞書を作成する

同僚が病気休暇を報告した後、ユーザーがメールを送信した際に、個人情報漏洩のいくつかの違反が起こりました。その際、病気や疾患の理由が送信されていました。そのようなことが起こらないようにしたいと思います。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. **Microsoft Edge** で、「Office 365 コンプライアンス センター」タブを開いておく必要があります。そうなっている場合は、それを選択し、次の手順に進みます。閉じてしまった場合は、新しいタブで **https://compliance.microsoft.com** に移動します。

3. 左側のウィンドウから「**データの分類**」を選択し、メニュータブで「**機密情報の種類**」を選択します。

4. 「**+ 機密情報の種類を作成する**」を選択し、新しい機密情報の種類を作成するウィザードを開きます。

5. 「**名前と説明の入力**」ページで「*Contoso Diseases List*」を「**名前**」に入力します。

6. 「**説明**」フィールドに「*考えられる従業員の疾病のリスト*」を入力し、「**次へ**」を選択します。

7. 「**この機密情報の種類のパターンを定義する**」ページで、「**+ パターンを作成する**」を選択します。

8. 「**主要要素**」の下のドロップダウン フィールドを選択し、「**キーワード辞書**」を選択します。

10. 「**キーワード辞書の追加**」ページで、「*Diseases Dictionary*」という名前を入力します。 

11. 「**キーワード**」領域に、次のキーワードをそれぞれ別々の行に入力します。

    ```
    flu
    influenza
    cold
    bronchitis
    otitis
    ```

12. 「**完了**」を選択します。

13. 「**補助要素**」の下で、「**+ 補助要素または要素のグループを追加**」ドロップダウンを選択し、「**キーワード リスト**」を選択ます。

14. 「**キーワード　リストの追加**」ページで、「**ID**」フィールドに「*従業員の欠勤*」と入力します。「**大文字と小文字を区別しない**」ボックスに、次のキーワードをそれぞれ別々の行に入力します。
    
    ```
    employee
    absence
    reason
    ```

15. 「**完了**」を選択します。

16. 「**新しいパターン**」ページで、構成を確認し、「**作成**」を選択します。

17. 「**この機密情報の種類のパターンを定義する**」で、「**次へ**」を選択します。

18. 「**コンプライアンス ポリシーに表示する推奨の信頼度レベルを選択する**」で、既定値を維持して「**次へ**」を選択します。 

19. 「**設定を確認して完了する**」ページで、設定を確認し、「**作成**」を選択します。  処理が完了したら、「**完了**」を選択します。

20. Microsoft 365 コンプライアンス センター のブラウザー画面は開いたままにします。

キーワード辞書に基づいて新しい機密情報の種類を作成し、さらにキーワードを追加して、誤検知率を下げることができました。次のタスクに進みます。

### タスク 5 - 作成したカスタム機密情報の種類をテストする

カスタム機密情報の種類はポリシーで利用する前に必ずテストする必要があります。テストをしなかった場合、カスタム検索のパターンが動作せず、データの損失や漏えいが発生する可能性があります。 

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. 左下の Windows シンボルを選択して、スタート メニューを開き、「**Notepad**」と入力して、スタートメニューから「**メモ帳**」を選択します。

3. メモ帳のウィンドウに次のテキストを入力します。

    ```
    Employee Joni Sherman EMP123456 is on absence because of the flu/influenza.
    ```

4. 「**ファイル**」、「**名前を付けて保存**」の順に選択します。

5. 左側のウィンドウで「ドキュメント」を選択します。

6. 「**ファイル名**」フィールドに「*SickTestData*」と入力し、「**保存**」を選択します

7. メモ帳ウィンドウを閉じます。

8. **Microsoft Edge** で、「Office 365 コンプライアンス センター」タブを開きます。閉じてしまった場合は、**https://compliance.microsoft.com** に移動します。

9. 左のナビゲーション ウィンドウで、「**データの分類**」を選択し、「**機密情報の種類**」タブを選択します。

10. 右上の「**検索**」ボックスに「*Contoso*」と入力し、Enter キーを押します。

11. 「**Contoso 従業員 ID**」を選択して、右側のウィンドウを開きます。

12. 右側のウィンドウで「**テスト**」を選択します。

13. 「**テストの対象ファイルのアップロード**」ページで、「**ファイルのアップロード**」を選択します。

14. 左側のウィンドウで「**ドキュメント**」を選択し、「*SickTestData*」という名前のファイルを選択し、「**開く**」を選択します。

15. 「**テスト**」をクリックして、分析を開始します。

16. 「**一致する検索結果**」のページで、見つかった一致する検索結果を確認します。

17. 「**終了**」を選択してページを閉じます。

18. 「**データの分類**」ページに戻り、「**Contoso Diseases List**」という名前の秘密情報の種類を選択します。

19. 右側のペインで「**テスト**」を選択します。

20. 「**テストの対象ファイルのアップロード**」ページで、「**ファイルのアップロード**」を選択します。

21. 左側のウィンドウで「**ドキュメント**」を選択し、「*SickTestData*」という名前のファイルを選択し、「**開く**」を選択します。

22. 「**テスト**」を選択して、分析を開始します。

23. 「**一致する検索結果**」のページで、見つかった一致する検索結果を確認します。確認が完了したら、「**完了**」を選択します。

2 つの秘密情報の種類をテストし、検索パターンが目標とするパターンを認識することを検証しました。機密情報の種類の作成が終了しました。次の演習に進めます。

# 演習 4 に進みます。 
